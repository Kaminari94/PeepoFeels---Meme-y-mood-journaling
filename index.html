<!DOCTYPE html>
<html data-bs-theme="dark">
	<head>
		<meta charset=utf-8>
		<meta name="viewport" content="width=device-width">
		<link rel="shortcut icon" href="assets/favicon.ico">
		<title>PeepoFeels - Meme-y mood journaling</title>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
		<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.bootstrap5.min.css">
		<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
		<link href="style.css" rel="stylesheet" type="text/css" />
	</head>
	<body ng-app="emoApp">
		<div class="container mt-3">
			<div class="row">
				<div class="col-10">
					<h1 class="d-none d-lg-inline mt-3"><!--<i class="bi bi-emoji-smile"></i>--><img class="mb-4" src="assets/emotions/love.png" width="64" height="64"> PeepoFeels</h1>
					<h3 class="d-none d-lg-block mt-1"><i>Meme-y mood journaling</i></h3>
					<h5 class="mt-3 d-lg-none"><!--<i class="bi bi-emoji-smile"></i>--><img class="mb-4" src="assets/emotions/love.png" width="32" height="32"> PeepoFeels</h3>
					<h6 class="mt-1 d-lg-none"><i>Meme-y mood journaling</i></h6>
				</div>
				<div class="col-2 d-flex align-items-center justify-content-end">
					<button class="btn btn-sm btn-outline-primary" ng-controller="ThemeToggle" ng-click="toggleTheme()">
					  <i class="bi" ng-class="theme==='dark' ? 'bi-brightness-high-fill' : 'bi-moon-fill'"></i>
					</button>
				</div>
			</div>
			<div class="row">
				<nav class="nav nav-tabs mt-3" id="nav-tab" role="tablist">
				  <a class="nav-link active" id="nav-emotion-tab" data-bs-toggle="tab" href="#nav-emotion" role="tab" aria-controls="nav-emotion" aria-selected="true">Emotions</a>
				  <a class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false">Stats & Graphs</a>
				  <a class="nav-link" id="nav-table-tab" data-bs-toggle="tab" href="#nav-table" role="tab" aria-controls="nav-table" aria-selected="false">DataTable</a>
				</nav>
				<div class="tab-content" id="nav-tabContent">
				  <div class="tab-pane fade show active" id="nav-emotion" role="tabpanel" aria-labelledby="nav-emotion-tab">
					<div id="emotionCarousel" class="carousel slide mt-3" data-bs-ride="false" ng-controller="MainCtrl">
					    <!-- Arrows at the top -->
						<div class="carousel-controls-top d-flex justify-content-between position-absolute top-0 start-0 end-0 px-3 py-2">
							<a class="carousel-control-prev mt-5" href="#emotionCarousel" role="button" data-bs-slide="prev">
								<i class="mt-5 h2 bi bi-arrow-left-circle-fill text-secondary" aria-hidden="true"></i>
								<span class="visually-hidden">Previous</span>
							</a>
							<a class="carousel-control-next mt-5" href="#emotionCarousel" role="button" data-bs-slide="next">
								<i class="mt-5 h2 bi bi-arrow-right-circle-fill text-secondary" aria-hidden="true"></i>
								<span class="visually-hidden">Next</span>
							</a>
						</div>
					  <div class="carousel-inner text-center">
						<div class="carousel-item" ng-repeat="emo in primary.emotions" ng-class="{active:$first}">
						  <img ng-src="{{emo.img}}" alt="{{emo.name}}" class="img-responsive center-block">
						  <div class="mt-2">
							<div class="mb-1 h3" ng-class="$root.theme==='dark' ? 'text-light' : 'text-dark'">{{emo.name}}</div>
							<div class="mb-1 h5" ng-class="$root.theme==='dark' ? 'text-light' : 'text-dark'"></div>
							<!-- layout for the subemotions-->
						<div class="mt-3">
							<h6 class="mb-2 h5">{{emo.subemotions.length}} Subemotions:</h6>
							<div class="d-flex justify-content-center">
							<input type="text" class="text-center form-control w-75" placeholder="Add an optional comment..." ng-model="comment">
							</div>
							<div class="d-flex flex-wrap justify-content-center">
								<div ng-repeat="subemo in emo.subemotions" class="flex-row m-1">
									<!-- Category -->
									<div class="mt-2 mb-2">
										<h5 class="">{{subemo.name}}:</h5>
									</div>
									
									<!-- Sub-items -->
									<div class="m-2">
										<div ng-repeat="subsubemo in subemo.subemotions" 
											 class="small"
											 ng-click="pick(subsubemo.name, subemo.name, emo.name, comment)">
											<button class="btn btn-sm btn-secondary mb-1 w-100">{{subsubemo.name}}</button>
										</div>
									</div>
									
								</div>
							</div>
							
								
						</div>
						  </div>
						</div>
					  </div>

					  <!-- controls bottom 
					  <a class="carousel-control-prev" href="#emotionCarousel" role="button" data-bs-slide="prev">
						<span class="carousel-control-prev-icon" aria-hidden="true"></span>
						<span class="visually-hidden">Previous</span>
					  </a>
					  <a class="carousel-control-next" href="#emotionCarousel" role="button" data-bs-slide="next">
						<span class="carousel-control-next-icon" aria-hidden="true"></span>
						<span class="visually-hidden">Next</span>
					  </a>--->
					  </div>

				  </div>
				<div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab" ng-controller="Statistics">
							<div class="mt-2 h3" ng-if="data.length === 0">No Data! Go choose some emotions!</div>
							<div class="mt-2 h5 text-center" ng-if="data.length != 0">Exploring data for {{data.length}} entries:</div>
							<div class="chart-box mt-3">
								<h5 class="chart-title text-center">Emotion over Time</h5>
								<select id="emotion-select" class="form-select m-1" aria-label="Default select" ng-model="selected_grandparent">
									<option value="">Choose one of the primary emotions...</option>
									<option ng-repeat="emo in primary.emotions" ng-value="emo">{{emo.name}}</option>
								</select>
								<div ng-if="selected_grandparent" class="mt-3" >
									<div class="d-flex flex-wrap d-flex-row justify-content-center">										
										<div ng-repeat="subemo in selected_grandparent.subemotions" class="d-flex-row m-1">
											<!-- Category -->
											<div class="mt-2 mb-2">
												<h6 class="" align="center">{{subemo.name}}:</h6>
											</div>
											
											<!-- Sub-items -->
											<div class="m-2">
												<div ng-repeat="subsubemo in subemo.subemotions" 
													 class="small"
													 ng-click="pick_line(subsubemo.name)">
													<button class="badge bg-secondary mb-1 w-100">{{subsubemo.name}}</button>
												</div>
											</div>
										</div>
									</div>
									<canvas class="chart chart-line" chart-data="emotionLine" chart-labels="emotionLabels" chart-series="emotionSeries" chart-click="onClick"></canvas>
								</div>
							</div>
							<hr>
							<div class="chart-box mt-3">
								<h5 class="chart-title text-center">Total Emotion Intensity</h5>
								<canvas class="chart chart-bar" chart-data="chartData" chart-labels="chartLabels" chart-series="chartSeries" chart-click="onClick"></canvas>
							</div>
							<hr>
							<div class="chart-box mt-3">
							  <h5 class="chart-title text-center">Entries by Weekday</h5>
							  <canvas class="chart chart-bar"
									  chart-data="weekdayData"
									  chart-labels="weekdayLabels"
									  chart-series="weekdaySeries">
							  </canvas>
							</div>	
				</div>

				<div class="tab-pane fade" id="nav-table" role="tabpanel" aria-labelledby="nav-table-tab" ng-controller="EntriesTable">
				<div class="mt-2">	
					<table datatable="ng"
						 dt-options="dtOptions"
						 dt-column-defs="dtColumnDefs"
						 class="table table-striped table-responsive table-bordered w-100">
					<thead>
					  <tr>
						<th><i class="bi bi-calendar-day"></i> Date</th>
						<th><i class="bi bi-emoji-smile"></i> Emotion</th>
						<th><i class="bi bi-chat-left-text"></i> Comment</th>
						<th class="text-end"><i class="bi bi-trash"></i></th>
					  </tr>
					</thead>
					<tbody>
					  <tr ng-repeat="r in rows track by $index">
						<td>{{ r.at | date:'yyyy-MM-dd HH:mm' }}</td>
						<td>{{ r.emotion }}</td>
						<td>{{ r.comment }}</td>
						<td class="text-end">
						<button class="btn btn-sm btn-outline-danger" ng-click="deleteRow(r.at)">
						  <i class="bi bi-trash"></i>
						</button>
					  </td>
					  </tr>
					</tbody>
				</table>
				  </div>
				</div>

				</div> <!-- tab-content-->
				</div>
				<hr>
				<div class="mb-2">
					<h5 align="center">Data Management:</h5>
				</div>
				<div class="d-flex mt-2 btn-group justify-content-center" ng-controller="DataConfig">
					<div>
					<button class="btn btn-sm btn-outline-primary" ng-click="exportData()">
					  <i class="bi bi-download"></i> Export JSON
					</button>

					<label class="btn btn-sm btn-outline-secondary">
					  <i class="bi bi-upload"></i> Import JSON
					  <input type="file" accept="application/json" 
							 style="display:none" 
							 onchange="angular.element(this).scope().importData(event)">
					</label>

					<button class="btn btn-sm btn-outline-danger" ng-click="clearData()">
					  <i class="bi bi-trash"></i> Delete All
					</button>
					</div>
				</div>
			</div>
		</div>
		<div class="toast-container position-fixed bottom-5 end-0 p-3">
		  <div id="savedToast" class="toast text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
			<div class="d-flex">
			  <div class="toast-body">Emotion logged!</div>
			  <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
			</div>
		  </div>
		</div>
		<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
		<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
		<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
		<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
		<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
		<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
		<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
		<script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
		<script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-datatables/0.6.4/angular-datatables.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-datatables/0.6.4/plugins/buttons/angular-datatables.buttons.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.bundle.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-chart.js/1.1.1/angular-chart.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
		<script src="script.js"></script>
	</body>
</html>